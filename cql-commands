Basic CQL Fundamentals
=====================

select * from system_schema.keyspaces;

create keyspace killrvideo with replication = {'class' : 'SimpleStrategy', 'replication_factor' : 1};

-- create keyspace killrvideo with replication = {'class' : 'org.apache.cassandra.locator.NetworkTopologyStrategy', 'DC1': '3'};

use killrvideo;


create table videos (
video_id timeuuid,
added_date timestamp,
description text,
title text,
user_id uuid,
PRIMARY KEY(video_id)
);

desc videos;

CREATE TABLE killrvideo.videos (
    video_id timeuuid PRIMARY KEY,
    added_date timestamp,
    description text,
    title text,
    user_id uuid
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';


COPY killrvideo.videos FROM 'videos.csv' WITH HEADER = TRUE;

Reading options from the command line: {'header': 'TRUE'}
Using 5 child processes

Starting copy of killrvideo.videos with columns [video_id, added_date, description, title, user_id].
Processed: 430 rows; Rate:      27 rows/s; Avg. rate:      33 rows/s
430 rows imported from 1 files in 12.957 seconds (0 skipped).


select * from videos limit 10;

 video_id                             | added_date               | description                                                                                                                                                       | title                                                                                             | user_id
--------------------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------
 26461a70-14bd-11e5-ad08-8438355b7e3a | 2014-05-07 00:00:00+0000 |       At Comcast we are working on the future of television. Change and innovation are happening more rapidly than ever thanks to the cloud based X1 platform ... |                                             Webinar: Building Blocks for the Future of Television | 10d5c76c-8767-4db3-8050-e19e015b524c
 2645e79c-14bd-11e5-a456-8438355b7e3a | 2011-10-21 00:00:00+0000 | DataStax is the developer of DataStax Enterprise, a distributed, scalable, and highly available database platform that delivers optimal performance either on ... |            DataStax Cassandra Tutorials - Understanding partitioning and replication in Cassandra | 10d5c76c-8767-4db3-8050-e19e015b524c
 9056808b-ca65-1bfb-9957-3bea148dfdce | 2015-03-09 00:00:02+0000 |         New hire Chip (Chris Hemsworth) learns it's not easy working alongside Lucious (Kenan Thompson), Cookie (Sasheer Zamata), Jamal (Jay Pharoah), Hakeem ... |                                                                                Empire Promo - SNL | 220077ff-be79-4f20-8603-1b9c97dbafa6
 264601a3-14bd-11e5-8c2e-8438355b7e3a | 2011-12-30 00:00:00+0000 |         Tyler Hobbs - Flexibility: Python Clients for Apache Cassandra DataStax, the commercial leader in Apache Cassandra, along with the NYC Cassandra User ... |                Cassandra NYC 2011: Tyler Hobbs - Flexibility: Python Clients for Apache Cassandra | 10d5c76c-8767-4db3-8050-e19e015b524c
 fe3c4045-6f37-1223-81be-250dc60cffc8 | 2015-01-16 22:46:44+0000 |                           Saturday Night Live celebrates 40 years of laughs! Get more SNL on Hulu Plus: http://www.hulu.com/saturday-night-live Get more SNL: ... |                                                      40 Years in the Making - Saturday Night Live | 539fd1b2-ff34-42c9-80cd-a34c91a772de
 2e8ecb4f-e92b-139b-8183-4df0e2a817bb | 2015-04-24 00:00:41+0000 |  As new types of data sources emerge from cloud, mobile devices, social media and machine sensor devices, traditional databases hit the ceiling due to today's... |           Webinar: Don't leave your data in the dark - Optimize and simplify database performance | 53a8ea04-018b-44c2-a420-c059f3f57324
 2646123a-14bd-11e5-b9db-8438355b7e3a | 2012-08-20 00:00:00+0000 |                                                                         Session: Cassandra in Action - Solving Big Data Problems Speaker: Eddie Satterly (Splunk) |                 C* 2012: Cassandra in Action - Solving Big Data Problems (Eddie Satterly, Splunk) | 10d5c76c-8767-4db3-8050-e19e015b524c
 bdb57288-e51c-1ff1-805d-c5f1e49c2c8b | 2015-01-19 08:00:00+0000 |               Join Helena Edelson, Senior Software Engineer at DataStax as she introduces Apache Spark and Cassandra, discusses common use cases an​​d explains ... | Webinar | Streaming Big Data Analytics with Team Apache Spark & Spark Streaming, Kafka, Cassandra | 66b25618-683a-4603-b3c9-caa83cd789e9
 2646278f-14bd-11e5-88ea-8438355b7e3a | 2012-04-27 00:00:00+0000 |   NoSQL is addressing some tough challenges that businesses have harnessing big data and consequently it's growing like a weed in the enterprise. But this is ... |                             Webinar: Top 5 gotchas that prevent NoSQL from meeting business goals | 10d5c76c-8767-4db3-8050-e19e015b524c
 607df86e-2208-18a8-90aa-6d837c659f2f | 2015-02-09 00:00:01+0000 |  Delegation allows you to use the user authentication and product subscription flow of your existing website as a replacement of the built-in flow in the API ... |                            Delegating User Authentication and Product Subscription to a 3rd Party | 723f6f5f-3658-4449-90d0-4391d63e50a8


select count(*) from videos;

 count
-------
   430


select * from videos where video_id = 6c4cffb9-0dc4-1d59-af24-c960b5fc3652;

 video_id                             | added_date               | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | title                                                                       | user_id
--------------------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------+--------------------------------------
 6c4cffb9-0dc4-1d59-af24-c960b5fc3652 | 2014-11-06 01:11:50+0000 | Speaker: Luke Tillman, Language Evangelist at DataStaxnnKeyboard Cat, Nyan Cat, and of course the world famous Grumpy Cat--it seems like the Internet can’t get enough cat videos. If you were building an application to let users share and consume their fill of videos, how would you go about it? In this talk, we’ll take a look at the data model for KillrVideo, a sample video sharing application similar to YouTube where users can share videos, comment, rate them, and more. You’ll learn get a practical introduction to Cassandra data modeling, querying with CQL, how the application drives the data model, and how to shift your thinking from the relational world you probably have experience with. | Cassandra Day Denver 2014: A Cassandra Data Model for Serving up Cat Videos | fd3f7889-fc0c-43db-951c-7b77710898bc

truncate videos;


Working with Partitions:
=======================

create table videos_by_title_year (
title text,
added_year int,
added_date timestamp,
description text,
user_id uuid,
video_id uuid,
PRIMARY KEY((title,added_year))
);

desc videos_by_title_year;

CREATE TABLE killrvideo.videos_by_title_year (
    title text,
    added_year int,
    added_date timestamp,
    description text,
    user_id uuid,
    video_id uuid,
    PRIMARY KEY ((title, added_year))
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';

COPY videos_by_title_year (title, added_year, added_date, description, user_id, video_id) FROM 'videos_by_title_year.csv' WITH HEADER=true;

Reading options from the command line: {'header': 'true'}
Using 5 child processes

Starting copy of killrvideo.videos_by_title_year with columns [title, added_year, added_date, description, user_id, video_id].
Processed: 430 rows; Rate:      28 rows/s; Avg. rate:      34 rows/s
430 rows imported from 1 files in 12.736 seconds (0 skipped).




SELECT * FROM videos_by_title_year WHERE title = 'Introduction To Apache Cassandra' AND added_year = 2014; 

 title                            | added_year | added_date               | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | user_id                              | video_id
----------------------------------+------------+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+--------------------------------------
 Introduction To Apache Cassandra |       2014 | 2014-11-06 01:01:00+0000 | This talk is part of Cerner's Tech Talk series. Check us out at http://engineering.cerner.com/ and @CernerEngnnApache Cassandra is a popular choice for a wide variety of application persistence needs. There are many design choices that can effect uptime and performance. In this talk we'll look at some of the many things to consider from a single server to multiple data centers. Basic understanding of Cassandra features coupled with client driver features can be a very powerful combination. This talk will be an introduction but will deep dive into the technical details of how Cassandra works.nnAbout the Speaker:nPatrick McFadin (@PatrickMcFadin) is the Chief Evangelist at DataStax, the leading distributor of Apache Cassandra. Cassandra is a widely used open source NoSQL database created at Facebook and used at companies like Netflix, eBay, and Twitter. McFadin has a lot of experience with open source and Cassandra. Prior to DataStax, McFadin was the Chief Architect for Hobsons where he used Cassandra extensively. | fd3f7889-fc0c-43db-951c-7b77710898bc | d6b62ec5-d3fa-130a-a3e9-8b95aa25a13e



SELECT * FROM videos_by_title_year WHERE title = 'Sleepy Grumpy Cat' AND added_year = 2015;

 title             | added_year | added_date               | description                                                                                                                     | user_id                              | video_id
-------------------+------------+--------------------------+---------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+--------------------------------------
 Sleepy Grumpy Cat |       2015 | 2015-02-14 00:00:01+0000 | Grumpy Cat waking up! Visit us at www.grumpycats.com New Tshirts at: http://www.tshirtoutlet.com/nsearch.html?query=grumpy+cat. | c443110f-d9d7-4b68-81b4-64a8e8f4d478 | e7d70ffc-b94f-15a8-b2ee-6ef4ccaf6227
 
 
 
SELECT * FROM videos_by_title_year WHERE title = 'Grumpy Cat: Slow Motion' AND added_year = 2015;

 title                   | added_year | added_date               | description                                                                                                                                            | user_id                              | video_id
-------------------------+------------+--------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+--------------------------------------
 Grumpy Cat: Slow Motion |       2015 | 2015-02-01 16:00:00+0000 | Grumpy Cat - The internet's grumpiest cat! Grumpy Cat Book: http://amzn.to/10Yd47R Grumpy Cat 2014 Calendar: http://amzn.to/YGK6MB New T-Shirts by ... | a15379d4-6d88-41bf-a46d-b4cac7707fc7 | e619d225-59a9-1ed8-b43f-dcf2905788c4



SELECT * FROM videos_by_title_year WHERE title = 'AzureDev' AND added_year = 2015;

 title    | added_year | added_date               | description | user_id                              | video_id
----------+------------+--------------------------+-------------+--------------------------------------+--------------------------------------
 AzureDev |       2015 | 2015-02-13 00:00:02+0000 |        null | 8cb63b7d-dc39-4881-8c62-f37f086d20da | 2c366de4-6ccc-1142-ba73-174b975f3f69
 
 
 
SELECT * FROM videos_by_title_year WHERE title = 'Introduction To Apache Cassandra';
InvalidRequest: Error from server: code=2200 [Invalid query] message="Partition key parts: added_year must be restricted as other parts are"


SELECT * FROM videos_by_title_year WHERE added_year = 2015;
InvalidRequest: Error from server: code=2200 [Invalid query] message="Partition key parts: title must be restricted as other parts are"


Clustering Columns
==================

create table bad_videos_by_tag_year1 (
tag text,
added_year int,
added_date timestamp,
title text,
description text,
user_id uuid,
video_id timeuuid,
PRIMARY KEY ((video_id))
);

desc bad_videos_by_tag_year1;

CREATE TABLE killrvideo.bad_videos_by_tag_year1 (
    video_id timeuuid PRIMARY KEY,
    added_date timestamp,
    added_year int,
    description text,
    tag text,
    title text,
    user_id uuid
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';

COPY killrvideo.bad_videos_by_tag_year1 (tag, added_year, video_id, added_date, description, title, user_id) FROM 'videos_by_tag_year.csv' with HEADER = true;

Reading options from the command line: {'header': 'true'}
Using 5 child processes

Starting copy of killrvideo.bad_videos_by_tag_year1 with columns [tag, added_year, video_id, added_date, description, title, user_id].
Processed: 797 rows; Rate:      48 rows/s; Avg. rate:      60 rows/s
797 rows imported from 1 files in 13.287 seconds (0 skipped).


select count(*) from bad_videos_by_tag_year1;

 count
-------
   422

The number of rows in the `bad_videos_by_tag_year` does not match the number of rows imported from `videos_by_tag_year.csv`. 
Since `videos_by_tag_year.csv` duplicates `video_id` for each unique `tag` and `year` per video, Cassandra upserted several records during the COPY. 
`video_id` is not a proper partition key for this scenario.

drop table bad_videos_by_tag_year1;


Restructure your table and allow users to query on 'tag' and possible 'added_year' ranges while avoiding upserts on import. 
You must also return your results in descending order of year.


create table videos_by_tag_year (
       tag text,
       added_year int,
       video_id timeuuid,
       added_date timestamp,
       description text,
       title text,
       user_id uuid,
       PRIMARY KEY ((tag),added_year,video_id)
     ) WITH CLUSTERING ORDER BY (added_year desc,video_id asc);

desc videos_by_tag_year;

CREATE TABLE killrvideo.videos_by_tag_year (
    tag text,
    added_year int,
    video_id timeuuid,
    added_date timestamp,
    description text,
    title text,
    user_id uuid,
    PRIMARY KEY (tag, added_year, video_id)
) WITH CLUSTERING ORDER BY (added_year DESC, video_id ASC)
    AND bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';

COPY videos_by_tag_year (tag,added_year,video_id,added_date,description,title,user_id) FROM 'videos_by_tag_year.csv' with HEADER = true;

Reading options from the command line: {'header': 'true'}
Using 5 child processes

Starting copy of killrvideo.videos_by_tag_year with columns [tag, added_year, video_id, added_date, description, title, user_id].
Processed: 797 rows; Rate:      46 rows/s; Avg. rate:      58 rows/s
797 rows imported from 1 files in 13.779 seconds (0 skipped).


select count(*) from videos_by_tag_year;

 count
-------
   797


select * from videos_by_tag_year where tag = 'trailer' and added_year = 2015;

 tag     | added_year | video_id                             | added_date               | description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | title                                                                                               | user_id
---------+------------+--------------------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+--------------------------------------
 trailer |       2015 | b9d9655f-5c53-1000-b93b-82d44a8f9ef7 | 2015-02-02 08:00:00+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Increasing regulations on patient data, expanding and ever-changing data volumes and formats, and the need for real-time analytics are adding new levels of c. |     Fifty Shades of Grey Official Super Bowl TV Spot (2015) - Jamie Dornan, Dakota Johnson Movie HD | 625676f7-f22a-461c-994c-2a90fca723e5
 trailer |       2015 | 0a29f63f-2d6c-10c5-b385-8c55d3dcc2fc | 2015-02-24 00:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SNL host Taraji P. Henson answers questions from fans on Twitter, about everything from how Empire has changed her life to her all-time favorite SNL character. |                                    Marcus Johns Oscar Red Carpet Recap (2015) - Celebs & Selfies HD | c96ddac8-ad86-4989-b58e-6303df8c018f
 trailer |       2015 | 6747bc1c-c313-110a-a23a-d15b9b2e6741 | 2015-01-25 16:00:00+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  This video discusses Azure HDInsight. Gain insights from real-life customer scenarios and learn to use Hadoop in your environment to solve big data challenge. |    Hot Tub Time Machine 2 Official Red Band Trailer #2 (2014) - Craig Robinson, Adam Scott Movie HD | a47a9adc-3d11-41d3-ad17-a18f912c1b34
 trailer |       2015 | 2b58135c-777c-14bd-95be-fdb3d1e4bef6 | 2015-03-28 00:00:04+0000 | Subscribe to TRAILERS:xa0http://bit.ly/sxaw6hnSubscribe to COMING SOON:xa0http://bit.ly/H2vZUnnLike us on FACEBOOK:xa0http://goo.gl/dHs73nRoboCop TRAILER 1 (2014) - Samuel L. Jackson, Abbie Cornish Movie HDnnnRobocop gets rebooted in this big-screen MGM production from director José Padilha. The picture will once again surround a slain police officer (played by The Killing's Joel Kinnaman) who gets resurrected as a crime-fighting cyborg until memories of his previous life begin to make him doubt his corrupt corporate overlords. Gary Oldman co-stars as the doctor who suffers a crisis-of-conscience after bringing life back to the man in the form of a mechanical body and reprogrammed brain, while Samuel L. Jackson plays a larger-than-life media mogul.nnmovieclips movie clips movieclipstrailers \new trailers\" \"trailers HD\" hd trailers movieclipsDOTcom trailer 2013 official HD zefr \"robocop trailer\" robocop robots \"gary oldman\" \"michael keaton\" \"José Padilha\" \"Douglas Urbanski\" \"abbie cornish\" \"Jay Baruchel\" \"Joel Kinnaman\" \"samuel l. jackson\" etimmons 2014 police cop""" |                                   Spectre Official Teaser Trailer #1 (2015) - Daniel Craig Movie HD | 25e31a9c-74b1-44f8-91cf-9003ac411f01
 trailer |       2015 | ccc13504-201c-15aa-ba48-d1ffa34cd7c7 | 2015-03-24 21:24:24+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Dr. Evil (Mike Myers) interrupts Sam Smith's (Taran Killam) Christmas special to address North Korea and Sony Pictures directly about the hack. Get more SNL ... |                                RoboCop TRAILER 1 (2014) - Samuel L. Jackson, Abbie Cornish Movie HD | 28552c6a-667b-4724-a784-236b2721722f
 trailer |       2015 | bc03d4ab-4097-17cb-b33d-9b15bfcd8938 | 2015-02-06 08:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            null |              Poltergeist Official Teaer Trailer #1 (2015) - Sam Rockwell, Rosemarie DeWitt Movie HD | d377bfbd-1f45-4b62-99be-f8af27f650d6
 trailer |       2015 | ef619531-a103-17d0-8d0c-a0a2b41ede2b | 2015-02-27 08:00:00+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                DataStax is hiring, Join us! Ready to join a fast paced start-up headquartered in the heart of Silicon Valley? At DataStax we are on the forefront of an incr... |                A Royal Night Out Official UK Trailer #1 (2015) - Sarah Gadon, Emily Watson Movie HD | 58e01298-0794-45e3-8fb1-68044c1ccc67
 trailer |       2015 | ea049e24-a6dc-17df-9a06-96a6c5d58300 | 2015-01-28 08:00:00+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Microsoft is excited about strong partner momentum around Microsoft Azure Machine Learning and our Advanced Analytics offerings. Hundreds of partners have ... |                     Seventh Son Official Comflix Trailer (2015) - Ben Barnes, Jeff Bridges Movie HD | 3014d9d5-b273-482c-8ab9-185b00131087
 trailer |       2015 | 584bbdbc-41e5-19d4-bda2-e6f4d1ec1f4a | 2015-03-07 00:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    WASH Multifamily Laundry Systems is growing rapidly and using Microsoft Cloud solutions such as Azure Machine Learning and Power BI to analyze data from ... |                     Woman in Gold Official Trailer #2 (2015) - Helen Mirren, Ryan Reynolds Movie HD | c7f21b67-4ca9-42b4-ac45-0620f903b06d
 trailer |       2015 | 14f0a299-9b27-1a15-9a83-116fce653f40 | 2015-04-20 00:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Part Two of Two! Corey is back with more information on Microsoft's partnership with Docker. |                 The Tale of Tales Official Trailer #1 (2015) - Salma Hayek, John C. Reilly Movie HD | a75cb774-8894-4339-a3ee-81f39f8af2ae
 trailer |       2015 | 6725f628-90b8-1a89-bd40-cb78b036fd32 | 2015-02-23 00:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Kevin Hart hosts Saturday Night Live with musical guest Sia on January 17, 2015. Get more SNL on Hulu Plus: http://www.hulu.com/saturday-night-live Get more ... |                               Focus Official Trailer #3 (2015) - Will Smith, Margot Robbie Movie HD | edf73326-2882-4207-9373-771551a61925
 trailer |       2015 | 5eb144ca-4c3f-1ac7-85ad-f536bee0d645 | 2015-04-16 08:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            null | Batman v. Superman: Dawn Of Justice Official Sneak Peek (2015) - Ben Affleck, Henry Cavill Movie HD | e17d8ed6-b17c-42fe-819b-b825896f0539
 trailer |       2015 | d95cb296-d60e-1c30-8e52-eb22b23f53c9 | 2015-03-23 16:00:03+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            null |       Mission: Impossible Rogue Nation Official Teaser Trailer (2015) - Tom Cruise Action Sequel HD | 0e1b176f-87e2-4439-bfe5-bec07e836811
 trailer |       2015 | 24153e4f-123d-1cbe-a767-d9a28972a31d | 2015-02-18 16:00:00+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         This is a crash course introduction to Cassandra. You'll step away understanding how it's possible to to utilize this distributed database to achieve high availability across multiple data centers, scale out as your needs grow, and not be woken up at 3am just because a server failed. We'll cover the basics of data modeling with CQL, and understand how that data is stored on disk. We'll wrap things up by setting up Cassandra locally, so bring your lapt |           The Last: Naruto the Movie Official US Release Trailer (2015) - Anime Action Adventure HD | d620cd62-9103-4cce-af1b-1b0513055b90
 trailer |       2015 | c3fa0ebe-d511-1d1a-8c97-02ff0e88957a | 2015-03-13 08:00:01+0000 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Dr. Gupta and a representative from the Make-A-Wish Foundation meet with a terminally ill boy, but the things he wants to do before he dies makes them both very uncomfortable.nnWatch more Key & Peele: http://on.cc.com/1wa82It |           Hotel Transylvania 2 Official International Teaser Trailer #1 (2015) - Animated Sequel HD | 0b50265d-af9c-4f42-a195-959af55809f6


select * from videos_by_tag_year where tag = 'cql' and added_year < 2015;

 tag | added_year | video_id                             | added_date               | description                                                                                                                                                      | title                                                           | user_id
-----+------------+--------------------------------------+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------+--------------------------------------
 cql |       2014 | b68132a3-7a41-10b3-9d9e-f60d2acf59bd | 2014-11-05 03:45:47+0000 | Speaker: J.B. Langston Company: DataStax I'll give a general lay of the land for troubleshooting Cassandra. I'll show you what to look for in the logs, what ... | The Last Pickle: Lesser Known Features of Cassandra 2.0 and 2.1 | fd3f7889-fc0c-43db-951c-7b77710898bc


select * from videos_by_tag_year where added_year < 2015;
InvalidRequest: Error from server: code=2200 [Invalid query] message="Cannot execute this query as it might involve data filtering and thus may have unpredictable performance. If you want to execute this query despite the performance unpredictability, use ALLOW FILTERING"


select * from videos_by_tag_year where added_year < 2015 ALLOW FILTERING;

 tag                   | added_year | video_id                             | added_date               | description                                                                                                                                                                                                       | title                                                                                             | user_id
-----------------------+------------+--------------------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------
               node.js |       2012 | 2645f570-14bd-11e5-bab9-8438355b7e3a | 2012-08-17 00:00:00+0000 |                                                 DataStax is the developer of DataStax Enterprise, a distributed, scalable, and highly available database platform that delivers optimal performance either on ... |               C* 2012: Lightning Talk #10 - Node.js and Cassandra (Russell Bradbury, SimpleReach) | 10d5c76c-8767-4db3-8050-e19e015b524c
                  solr |       2012 | 2645f6a6-14bd-11e5-bbaa-8438355b7e3a | 2012-08-20 00:00:00+0000 |                                             Stop writing monolithic web applications that are complex and inflexible! It's time to break everything apart into independently deployable services that make it ... |                             C* 2012: Changing the Game Cassandra + Solr (Matt Stump, SourceNinja) | 10d5c76c-8767-4db3-8050-e19e015b524c
                  solr |       2012 | 2645fdc5-14bd-11e5-bb31-8438355b7e3a | 2012-08-20 00:00:00+0000 |                                                                                                               Session: Lightning Talk #9 - How to write SQL Against Apache Cassandra Speaker: Peter Evans (Quest) |            C* 2012: Technical Deep Dive: Cassandra + Solr (Jason Rutherglen, Think Big Analytics) | 10d5c76c-8767-4db3-8050-e19e015b524c
            cat videos |       2014 | 6c4cffb9-0dc4-1d59-af24-c960b5fc3652 | 2014-11-06 01:11:50+0000 |                                     Carlito tries to show the members of his gang how wild and crazy he can be after a new initiate is labeled the loco one.\nnWatch more Key & Peele: http://on.cc.com/1FOng7W"" |                       Cassandra Day Denver 2014: A Cassandra Data Model for Serving up Cat Videos | fd3f7889-fc0c-43db-951c-7b77710898bc
             Cassandra |       2014 | 7372dd78-f207-1abe-b16d-0715d707cf31 | 2014-11-05 16:13:05+0000 |                                                                           Saturday Night Live celebrates 40 years of laughs! Get more SNL on Hulu Plus: http://www.hulu.com/saturday-night-live Get more SNL: ... |                                                                                 Datasax C# Driver | b2b3f953-60df-4aa4-b374-eee689f54318
                 nosql |       2013 | 2646094a-14bd-11e5-b26c-8438355b7e3a | 2013-06-25 00:00:00+0000 |                                                             Session: Cassandra at Telco Scale - Big Data, Mobile Apps, Optimized Footprint, and A/A Resiliency Speaker: Darshan Rawal (Openwave) Description: ... |                                Data Modelers Still Have Jobs: Adjusting For the NoSQL Environment | 10d5c76c-8767-4db3-8050-e19e015b524c
                 nosql |       2013 | 264612d1-14bd-11e5-bd8d-8438355b7e3a | 2013-05-01 00:00:00+0000 |                                                 As new types of data sources emerge from cloud, mobile devices, social media and machine sensor devices, traditional databases hit the ceiling due to today's ... |                                                          How to Tell if Your Business Needs NoSQL | 10d5c76c-8767-4db3-8050-e19e015b524c
                 nosql |       2012 | 2646193a-14bd-11e5-ae5b-8438355b7e3a | 2012-10-04 00:00:00+0000 |                                                                 Martin Stone - Deep Visibility into Apache Cassandra with AppDynamics DataStax, the commercial leader in Apache Cassandra, along with the NYC ... |                          Webinar: Bridging the Great Divide - The Relationship of RDBMS and NoSQL | 10d5c76c-8767-4db3-8050-e19e015b524c


Denormalizing
==================

create type if not exists video_encoding (
encoding text,
height int,
width int,
bit_rates set<text>
);


create table videos_by_actor ( 
actor text,
added_date timestamp, 
video_id timeuuid, 
character_name text, 
description text,
encoding frozen <video_encoding>, 
tags set<text>,
title text,
user_id uuid,
PRIMARY KEY ((actor), added_date, video_id, character_name) ) 
WITH CLUSTERING ORDER BY (added_date DESC, video_id ASC, character_name ASC);


desc videos_by_actor;

CREATE TABLE killrvideo.videos_by_actor (
    actor text,
    added_date timestamp,
    video_id timeuuid,
    character_name text,
    description text,
    encoding frozen<video_encoding>,
    tags set<text>,
    title text,
    user_id uuid,
    PRIMARY KEY (actor, added_date, video_id, character_name)
) WITH CLUSTERING ORDER BY (added_date DESC, video_id ASC, character_name ASC)
    AND bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';

COPY videos_by_actor from 'videos_by_actor.csv' with HEADER = True;

PicklingError: Can't pickle <class 'cqlshlib.copyutil.video_encoding'>: attribute lookup cqlshlib.copyutil.video_encoding failed
Processed: 81659 rows; Rate:   12862 rows/s; Avg. rate:    1002 rows/s
81659 rows imported from 1 files in 1 minute and 21.490 seconds (0 skipped).

select count(*) from videos_by_actor;

 count
-------
 81659
 
select * from videos_by_actor where actor = 'Leonardo DiCaprio' Limit 10;

 actor             | added_date               | video_id                             | character_name     | description | encoding                                                                                           | tags | title               | user_id
-------------------+--------------------------+--------------------------------------+--------------------+-------------+----------------------------------------------------------------------------------------------------+------+---------------------+--------------------------------------
 Leonardo DiCaprio | 2013-05-01 00:00:00+0000 | 8a53b805-0ef2-11e5-851b-8438355b7e3a |         Jay Gatsby |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |    The Great Gatsby | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2011-11-03 00:00:00+0000 | 8a374733-0ef2-11e5-a818-8438355b7e3a |    J. Edgar Hoover |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |            J. Edgar | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2010-07-08 00:00:00+0000 | 8a1a150f-0ef2-11e5-90db-8438355b7e3a |               Cobb |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |           Inception | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2010-02-13 00:00:00+0000 | 8a15ae61-0ef2-11e5-81e5-8438355b7e3a |      Teddy Daniels |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |      Shutter Island | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2008-12-15 00:00:00+0000 | 878e9fd9-0ef2-11e5-8a58-8438355b7e3a |      Frank Wheeler |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |  Revolutionary Road | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2008-10-05 00:00:00+0000 | 877ee4e6-0ef2-11e5-91cb-8438355b7e3a |       Roger Ferris |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |        Body of Lies | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2006-12-08 00:00:00+0000 | 8780a39e-0ef2-11e5-9ddb-8438355b7e3a |       Danny Archer |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |       Blood Diamond | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2006-09-26 00:00:00+0000 | 8769c4bd-0ef2-11e5-8fbc-8438355b7e3a |     Billy Costigan |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |        The Departed | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2004-12-14 00:00:00+0000 | 857bf1fd-0ef2-11e5-b36c-8438355b7e3a |      Howard Hughes |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |         The Aviator | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Leonardo DiCaprio | 2002-12-16 00:00:00+0000 | 859b3eae-0ef2-11e5-be7a-8438355b7e3a | Frank Abagnale Jr. |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null | Catch Me If You Can | 854c2cbc-a67d-4740-9164-0e166ab99a24

select actor, added_date from videos_by_actor where actor = 'Leonardo DiCaprio' Limit 10;

 actor             | added_date
-------------------+--------------------------
 Leonardo DiCaprio | 2013-05-01 00:00:00+0000
 Leonardo DiCaprio | 2011-11-03 00:00:00+0000
 Leonardo DiCaprio | 2010-07-08 00:00:00+0000
 Leonardo DiCaprio | 2010-02-13 00:00:00+0000
 Leonardo DiCaprio | 2008-12-15 00:00:00+0000
 Leonardo DiCaprio | 2008-10-05 00:00:00+0000
 Leonardo DiCaprio | 2006-12-08 00:00:00+0000
 Leonardo DiCaprio | 2006-09-26 00:00:00+0000
 Leonardo DiCaprio | 2004-12-14 00:00:00+0000
 Leonardo DiCaprio | 2002-12-16 00:00:00+0000



create table videos_by_genre ( 
genre text,
added_date timestamp, 
video_id timeuuid, 
description text,
encoding frozen<video_encoding>, 
tags set<text>,
title text,
user_id uuid,
PRIMARY KEY ((genre), added_date, video_id)) 
WITH CLUSTERING ORDER BY (added_date DESC, video_id ASC);


desc videos_by_genre;


CREATE TABLE killrvideo.videos_by_genre (
    genre text,
    added_date timestamp,
    video_id timeuuid,
    description text,
    encoding frozen<video_encoding>,
    tags set<text>,
    title text,
    user_id uuid,
    PRIMARY KEY (genre, added_date, video_id)
) WITH CLUSTERING ORDER BY (added_date DESC, video_id ASC)
    AND bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';


COPY videos_by_genre from 'videos_by_genre.csv' with HEADER = True;

PicklingError: Can't pickle <class 'cqlshlib.copyutil.video_encoding'>: attribute lookup cqlshlib.copyutil.video_encoding failed
Processed: 69620 rows; Rate:   13469 rows/s; Avg. rate:     864 rows/s
69620 rows imported from 1 files in 1 minute and 20.617 seconds (0 skipped).

select count(*) from killrvideo.videos_by_genre;

 count
-------
 69620

select * from videos_by_genre where genre = 'Musical' limit 10;

 genre   | added_date               | video_id                             | description | encoding                                                                                           | tags | title              | user_id
---------+--------------------------+--------------------------------------+-------------+----------------------------------------------------------------------------------------------------+------+--------------------+--------------------------------------
 Musical | 2014-06-15 00:00:00+0000 | 8a62de42-0ef2-11e5-b2fd-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |        Jersey Boys | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2014-03-10 00:00:00+0000 | 8a6235dc-0ef2-11e5-8563-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |       Stage Fright | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2013-11-27 00:00:00+0000 | 8a5b9eb5-0ef2-11e5-aae4-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |     Black Nativity | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2013-11-10 00:00:00+0000 | 8a5b63c5-0ef2-11e5-ae3c-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |             Frozen | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2012-12-05 00:00:00+0000 | 8a4c790f-0ef2-11e5-af5b-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |     Les Misérables | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2012-07-26 00:00:00+0000 | 8a45fe61-0ef2-11e5-bff6-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null | Step Up Revolution | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2012-06-13 00:00:00+0000 | 8a40b3f8-0ef2-11e5-9aee-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |       Rock of Ages | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2012-05-19 00:00:00+0000 | 8a53a8a8-0ef2-11e5-88b2-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |      The Sapphires | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2012-01-13 00:00:00+0000 | 8a480d42-0ef2-11e5-9cdb-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |       Joyful Noise | 854c2cbc-a67d-4740-9164-0e166ab99a24
 Musical | 2011-10-06 00:00:00+0000 | 8a3a5d78-0ef2-11e5-b313-8438355b7e3a |        null | {encoding: '1080p', height: 1080, width: 1920, bit_rates: {'3000 Kbps', '4500 Kbps', '6000 Kbps'}} | null |          Footloose | 854c2cbc-a67d-4740-9164-0e166ab99a24

User Defined Types (UDTs)
========================

desc videos;

CREATE TABLE killrvideo.videos (
    video_id timeuuid PRIMARY KEY,
    added_date timestamp,
    description text,
    title text,
    user_id uuid
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';


alter table videos add tags set<text>;

desc videos;

CREATE TABLE killrvideo.videos (
    video_id timeuuid PRIMARY KEY,
    added_date timestamp,
    description text,
    tags set<text>,
    title text,
    user_id uuid
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';
    
COPY videos from '/home/local/c5201418/videos.csv' with Header = True;

select count(*) from videos;

 count
-------
   430

alter table videos add encoding FROZEN<video_encoding>;

CREATE TABLE killrvideo.videos (
    video_id timeuuid PRIMARY KEY,
    added_date timestamp,
    description text,
    encoding frozen<video_encoding>,
    tags set<text>,
    title text,
    user_id uuid
) WITH bloom_filter_fp_chance = 0.1
    AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'}
    AND comment = ''
    AND compaction = {'class': 'org.apache.cassandra.db.compaction.LeveledCompactionStrategy', 'enabled': 'true', 'max_threshold': '32', 'min_threshold': '4'}
    AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'}
    AND crc_check_chance = 1.0
    AND dclocal_read_repair_chance = 0.1
    AND default_time_to_live = 0
    AND gc_grace_seconds = 864000
    AND max_index_interval = 2048
    AND memtable_flush_period_in_ms = 0
    AND min_index_interval = 128
    AND read_repair_chance = 0.0
    AND speculative_retry = '99p';


COPY videos from '/home/local/c5201418/videos_encoding.csv' with Header = True;


 video_id                             | added_date               | description                                                                                                                                                       | encoding | tags                                  | title                                                                                             | user_id
--------------------------------------+--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+---------------------------------------+---------------------------------------------------------------------------------------------------+--------------------------------------
 26461a70-14bd-11e5-ad08-8438355b7e3a | 2014-05-07 00:00:00+0000 |       At Comcast we are working on the future of television. Change and innovation are happening more rapidly than ever thanks to the cloud based X1 platform ... |     null |              {'cassandra', 'webinar'} |                                             Webinar: Building Blocks for the Future of Television | 10d5c76c-8767-4db3-8050-e19e015b524c
 2645e79c-14bd-11e5-a456-8438355b7e3a | 2011-10-21 00:00:00+0000 | DataStax is the developer of DataStax Enterprise, a distributed, scalable, and highly available database platform that delivers optimal performance either on ... |     null |             {'cassandra', 'tutorial'} |            DataStax Cassandra Tutorials - Understanding partitioning and replication in Cassandra | 10d5c76c-8767-4db3-8050-e19e015b524c
 9056808b-ca65-1bfb-9957-3bea148dfdce | 2015-03-09 00:00:02+0000 |         New hire Chip (Chris Hemsworth) learns it's not easy working alongside Lucious (Kenan Thompson), Cookie (Sasheer Zamata), Jamal (Jay Pharoah), Hakeem ... |     null |                               {'snl'} |                                                                                Empire Promo - SNL | 220077ff-be79-4f20-8603-1b9c97dbafa6
 264601a3-14bd-11e5-8c2e-8438355b7e3a | 2011-12-30 00:00:00+0000 |         Tyler Hobbs - Flexibility: Python Clients for Apache Cassandra DataStax, the commercial leader in Apache Cassandra, along with the NYC Cassandra User ... |     null |               {'cassandra', 'python'} |                Cassandra NYC 2011: Tyler Hobbs - Flexibility: Python Clients for Apache Cassandra | 10d5c76c-8767-4db3-8050-e19e015b524c
 fe3c4045-6f37-1223-81be-250dc60cffc8 | 2015-01-16 22:46:44+0000 |                           Saturday Night Live celebrates 40 years of laughs! Get more SNL on Hulu Plus: http://www.hulu.com/saturday-night-live Get more SNL: ... |     null |        {'saturday night live', 'snl'} |                                                      40 Years in the Making - Saturday Night Live | 539fd1b2-ff34-42c9-80cd-a34c91a772de
 2e8ecb4f-e92b-139b-8183-4df0e2a817bb | 2015-04-24 00:00:41+0000 |  As new types of data sources emerge from cloud, mobile devices, social media and machine sensor devices, traditional databases hit the ceiling due to today's... |     null |                 {'cloud', 'database'} |           Webinar: Don't leave your data in the dark - Optimize and simplify database performance | 53a8ea04-018b-44c2-a420-c059f3f57324
 2646123a-14bd-11e5-b9db-8438355b7e3a | 2012-08-20 00:00:00+0000 |                                                                         Session: Cassandra in Action - Solving Big Data Problems Speaker: Eddie Satterly (Splunk) |     null |             {'big data', 'cassandra'} |                 C* 2012: Cassandra in Action - Solving Big Data Problems (Eddie Satterly, Splunk) | 10d5c76c-8767-4db3-8050-e19e015b524c
 bdb57288-e51c-1ff1-805d-c5f1e49c2c8b | 2015-01-19 08:00:00+0000 |               Join Helena Edelson, Senior Software Engineer at DataStax as she introduces Apache Spark and Cassandra, discusses common use cases an​​d explains ... |     null | {'big data', 'cassandra', 'datastax'} | Webinar | Streaming Big Data Analytics with Team Apache Spark & Spark Streaming, Kafka, Cassandra | 66b25618-683a-4603-b3c9-caa83cd789e9
 2646278f-14bd-11e5-88ea-8438355b7e3a | 2012-04-27 00:00:00+0000 |   NoSQL is addressing some tough challenges that businesses have harnessing big data and consequently it's growing like a weed in the enterprise. But this is ... |     null |                  {'nosql', 'webinar'} |                             Webinar: Top 5 gotchas that prevent NoSQL from meeting business goals | 10d5c76c-8767-4db3-8050-e19e015b524c
 607df86e-2208-18a8-90aa-6d837c659f2f | 2015-02-09 00:00:01+0000 |  Delegation allows you to use the user authentication and product subscription flow of your existing website as a replacement of the built-in flow in the API ... |     null |                               {'cat'} |                            Delegating User Authentication and Product Subscription to a 3rd Party | 723f6f5f-3658-4449-90d0-4391d63e50a8



Using Counters in CQL
=====================


create table videos_count_by_tag (
tag text,
added_year int,
video_count counter,
PRIMARY KEY (tag, added_year)
);


source '/home/local/c5201418/videos_count_by_tag.cql';

select * from videos_count_by_tag;

 tag                   | added_year | video_count
-----------------------+------------+-------------
    internet of things |       2015 |           1
               node.js |       2012 |           1
               node.js |       2015 |           1
               asp.net |       2015 |          16
                  solr |       2012 |           2
            Jon Haddad |       2015 |           2
            cat videos |       2014 |           1
             microsoft |       2015 |          37
       Patrick McFadin |       2015 |           1
             Cassandra |       2014 |           1
                 nosql |       2011 |           1
                 nosql |       2012 |           3
                 nosql |       2013 |           2
                 nosql |       2015 |          18
             opscenter |       2011 |           4
             opscenter |       2012 |           1
             opscenter |       2013 |           1
                   dse |       2011 |           1
                   dse |       2012 |           3
                   dse |       2013 |           4
                   dse |       2014 |           2
                   dse |       2015 |           3
              wildlife |       2015 |           1
                  java |       2011 |           1
                   iot |       2014 |           1
                   iot |       2015 |           1
               trailer |       2015 |          15
                movies |       2015 |           1
          introduction |       2014 |           1
            data model |       2014 |           1
            data model |       2015 |           3
            windows 10 |       2015 |           2
              tutorial |       2011 |           8
              tutorial |       2012 |           1
              tutorial |       2015 |           6
                   aws |       2012 |           1
           time series |       2015 |           2
                python |       2011 |           1
                Driver |       2014 |           1
                 funny |       2015 |          21
 cassandra summit 2014 |       2014 |           4
              datastax |       2011 |           1
              datastax |       2012 |           7
              datastax |       2013 |           8
              datastax |       2014 |           7
              datastax |       2015 |          31
                   cat |       2015 |          64
               preview |       2015 |           3
                docker |       2015 |           2
                summit |       2014 |           1
     Christopher Batey |       2015 |           1
             cassandra |       2011 |          22
             cassandra |       2012 |          41
             cassandra |       2013 |           2
             cassandra |       2014 |          13
             cassandra |       2015 |          65
   saturday night live |       2015 |          22
                 linux |       2015 |           6
                   sql |       2011 |           1
                   sql |       2012 |           1
              big data |       2012 |           3
              big data |       2013 |           1
              big data |       2014 |           1
              big data |       2015 |           4
          call of duty |       2014 |           1
                 movie |       2015 |          15
                meetup |       2015 |           2
                comedy |       2015 |          28
               webinar |       2011 |           2
               webinar |       2012 |           2
               webinar |       2013 |           3
               webinar |       2014 |          10
               webinar |       2015 |           6
                 cloud |       2015 |          23
                 titan |       2012 |           1
         data modeling |       2011 |           1
         data modeling |       2012 |           2
         data modeling |       2013 |           2
                 Azure |       2014 |           2
                    C# |       2014 |           1
          Luke Tillman |       2015 |           2
      machine learning |       2015 |           7
              security |       2013 |           1
             devcenter |       2013 |           1
              database |       2014 |           1
              database |       2015 |          28
              beginner |       2015 |           2
                 azure |       2015 |          55
               Datasax |       2014 |           1
            grumpy cat |       2015 |          24
                   cql |       2014 |           1
         key and peele |       2015 |          22
                   snl |       2015 |          33
               windows |       2015 |          11
                  .net |       2015 |          18
                 spark |       2014 |           1
               robocop |       2015 |           1
               animals |       2015 |           1
                cerner |       2014 |           1
                
                
UPDATE videos_count_by_tag SET video_count = video_count + 1 WHERE tag = 'cassandra' AND added_year = 2015;

SELECT * FROM videos_count_by_tag WHERE tag = 'cassandra' AND added_year = 2015;

 tag       | added_year | video_count
-----------+------------+-------------
 cassandra |       2015 |          66
